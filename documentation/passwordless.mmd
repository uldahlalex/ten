sequenceDiagram
    participant U as User/Phone
    participant C as Client App
    participant S as Server
    participant DB as Database

    rect rgb(0,0,0,0)
        Note over U,DB: REGISTRATION PHASE
        C->>S: POST /register {username: "john"}
        S->>S: Generate TOTP secret<br/>(e.g. "JBSWY3DPEHPK3PXP")
        S->>DB: Store username + secret

        Note over S: Create otpauth URL:<br/>otpauth://totp/YourApp:john?<br/>secret=JBSWY3DPEHPK3PXP&<br/>issuer=YourApp

        Note over S: Convert URL to QR code
        S-->>C: Return QR code
        U->>C: Scan QR code with phone
        Note over U: Authenticator app parses URL:<br/>1. App name: YourApp<br/>2. Username: john<br/>3. Secret: JBSWY3DPEHPK3PXP
        Note over U: Authenticator stores secret<br/>and starts generating codes
    end

    rect rgb(0,0,0,0)
        Note over U,DB: LATER: LOGIN PHASE
        Note over U: Authenticator uses stored secret<br/>+ current time to generate code
        U->>C: Enter username + 6-digit code
        C->>S: POST /login {<br/>username: "john",<br/>totpCode: "847591"<br/>}
        S->>DB: Get stored secret for "john"
        S->>S: Generate code using:<br/>1. Stored secret<br/>2. Current time
        S->>S: Compare codes
        alt Codes match
            S->>S: Generate JWT
            S-->>C: Return JWT token
        else Codes don't match
            S-->>C: Return error
        end
    end